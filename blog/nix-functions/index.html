<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="/style.css">
  
  <title>skoove.dev - nix functions</title>
  

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://skoove.dev/rss.xml">
  
</head>

<body>
  <header>
    <a href="/">
      <h1 class="site_name">skoove.dev</h1>
    </a>

    <nav>
      
      <li><a href="&#x2F;blog">
          <h1 class="nav_button">blog</h1>
        </a></li>
      
      <li><a href="&#x2F;about">
          <h1 class="nav_button">about</h1>
        </a></li>
      
      <li><a href="&#x2F;now">
          <h1 class="nav_button">now</h1>
        </a></li>
      
    </nav>
  </header>
  <hr>

  <section class="section">
    <div class="container">
      
<h1 class="title">
  nix functions
</h1>
<nav class="page-nav">
  
  <a class="next-page" href="https:&#x2F;&#x2F;skoove.dev&#x2F;blog&#x2F;undersea-devlog-1&#x2F;">&lt undersea devlog #1</a>
  
  
  <a class="previous-page" href="https:&#x2F;&#x2F;skoove.dev&#x2F;blog&#x2F;arma-3-on-linux&#x2F;">arma 3 on linux &gt </a>
  
</nav>
<p class="subtitle"><strong>2025-07-23</strong></p>
<h1 id="the-basics"><a class="zola-anchor" href="#the-basics" aria-label="Anchor link for: the-basics">the basics</a></h1>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#fa5c4b;">let </span><span style="color:#8ec07c;">f </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">arg</span><span>: </span><span style="color:#fdf4c1;">arg </span><span style="color:#fe8019;">+ </span><span style="color:#d3869b;">1</span><span>; </span><span style="color:#fa5c4b;">in
</span><span style="color:#fdf4c1;">f </span><span style="color:#d3869b;">5 </span><span style="font-style:italic;color:#928374;"># evaluates to 6
</span></code></pre>
<p>Basic function syntax is simple, we provide one argument and get one output, and a function can only have one input and output. But what if we wanted multiple armament?</p>
<h2 id="multiple-arguments"><a class="zola-anchor" href="#multiple-arguments" aria-label="Anchor link for: multiple-arguments">multiple arguments</a></h2>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#fa5c4b;">let </span><span style="color:#8ec07c;">add </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">num_1</span><span>: </span><span style="color:#fdf4c1;">num_2</span><span>: </span><span style="color:#fdf4c1;">num_1 </span><span style="color:#fe8019;">+ </span><span style="color:#fdf4c1;">num_2</span><span>; </span><span style="color:#fa5c4b;">in
</span><span style="color:#fdf4c1;">add </span><span style="color:#d3869b;">1 3 </span><span style="font-style:italic;color:#928374;"># evaluates to 4
</span></code></pre>
<p>Here <code>add</code> can take in 2 numbers <code>num_1</code> and <code>num_2</code> and return the result of adding both. But wait, didn't I just say that a function can only have one input and output? Yes, but this function is two separate functions. The first function is <code>add</code> this function takes <code>num_1</code> and returns a function that takes <code>num_2</code> as an input<sup class="footnote-reference" id="fr-currying_wiki-1"><a href="#fn-currying_wiki">1</a></sup>. We can follow this by going through the function step by step.</p>
<ol>
<li><code>add 1 3</code></li>
<li><code>(num_1: num_2: num_1 + num_2) 1 3</code> <sup class="footnote-reference" id="fr-anon_functions-1"><a href="#fn-anon_functions">2</a></sup></li>
<li><code>(num_2: 1 + num_2) 3</code></li>
<li><code>1 + 3</code></li>
</ol>
<p>An alternative way of creating functions is attribute sets. In reality, we are actually only passing a single argument in — the attribute set.</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#fa5c4b;">let </span><span style="color:#8ec07c;">add </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">{ </span><span style="color:#fdf4c1;">num_1 </span><span style="color:#fe8019;">, </span><span style="color:#fdf4c1;">num_2 </span><span style="color:#d3869b;">}</span><span>: </span><span style="color:#fdf4c1;">num_1 </span><span style="color:#fe8019;">+ </span><span style="color:#fdf4c1;">num_2</span><span>; </span><span style="color:#fa5c4b;">in
</span><span style="color:#fdf4c1;">add </span><span>{ </span><span style="color:#8ec07c;">num_1 </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">1</span><span>; </span><span style="color:#8ec07c;">num_2 </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">6</span><span>; } </span><span style="font-style:italic;color:#928374;"># evaluates to 7
</span></code></pre>
<p>An attribute set is just a set of keys and values. To say that we want our function to take in an attribute set, we provide a comma-separated list of the keys we should have enclosed <code>{}</code>, <code>{ num_1 , num_2 }:</code> followed by the function itself <code>num_1 + num_2</code>. To call the function we need to construct an attribute set, done by providing the keys and values separated by <code>;</code> and enclosed with <code>{}</code>. This is a more simple, but more verbose way of providing arguments, but is often the better choice for clarity when you have several arguments (in my opinion).</p>
<h1 id="example"><a class="zola-anchor" href="#example" aria-label="Anchor link for: example">example</a></h1>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#d3869b;">{ </span><span style="color:#fe8019;">... </span><span style="color:#d3869b;">}</span><span>:
</span><span>{
</span><span>  </span><span style="color:#8ec07c;">services</span><span>.</span><span style="color:#8ec07c;">caddy </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>    </span><span style="color:#8ec07c;">virtualHosts </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">let
</span><span>      </span><span style="color:#8ec07c;">mkReverseProxy </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">{</span><span style="color:#fdf4c1;">domain</span><span style="color:#fe8019;">, </span><span style="color:#fdf4c1;">ip</span><span style="color:#d3869b;">}</span><span>: {
</span><span>        </span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">domain</span><span style="font-style:italic;color:#fdf4c1aa;">} </span><span style="color:#fe8019;">= </span><span>{
</span><span>          </span><span style="color:#8ec07c;">extraConfig </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&#39;&#39;
</span><span style="color:#b8bb26;">            tls internal
</span><span style="color:#b8bb26;">            reverse_proxy </span><span style="font-style:italic;color:#b8bb26;">${</span><span style="color:#fdf4c1;">ip</span><span style="font-style:italic;color:#b8bb26;">}</span><span style="color:#b8bb26;"> {
</span><span style="color:#b8bb26;">              transport http {
</span><span style="color:#b8bb26;">                tls
</span><span style="color:#b8bb26;">                tls_insecure_skip_verify
</span><span style="color:#b8bb26;">              }
</span><span style="color:#b8bb26;">            }
</span><span style="color:#b8bb26;">          &#39;&#39;</span><span>;
</span><span>        };
</span><span>      };
</span><span>      </span><span style="color:#8ec07c;">proxies </span><span style="color:#fe8019;">= </span><span>[
</span><span>        { </span><span style="color:#8ec07c;">domain </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;proxmox-1.home.com&quot;</span><span>; </span><span style="color:#8ec07c;">ip </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;192.168.0.230:8006&quot;</span><span>; }
</span><span>        { </span><span style="color:#8ec07c;">domain </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;proxmox-2.home.com&quot;</span><span>; </span><span style="color:#8ec07c;">ip </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;192.168.0.231:8006&quot;</span><span>; }
</span><span>        { </span><span style="color:#8ec07c;">domain </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;jellyfin.home.com&quot;</span><span>; </span><span style="color:#8ec07c;">ip </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;localhost:8096&quot;</span><span>; }
</span><span>      ];
</span><span>    </span><span style="color:#fa5c4b;">in
</span><span>      </span><span style="color:#d3869b;">builtins</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">foldl&#39; </span><span>(</span><span style="color:#fdf4c1;">acc</span><span>: </span><span style="color:#fdf4c1;">val</span><span>: </span><span style="color:#fdf4c1;">acc </span><span style="color:#fe8019;">// </span><span style="color:#fdf4c1;">mkReverseProxy val</span><span>) {} </span><span style="color:#fdf4c1;">proxies</span><span>;
</span><span>  };
</span><span>}
</span></code></pre>
<p>Here, we have a few things, we define a function <code>mkReverseProxy</code> which takes in an attribute with keys <code>domain</code> and <code>ip</code> which simply does some string interpolation to generate the <a href="https://caddyserver.com/">caddy</a> configuration for reverse proxies. In the <code>proxies</code> array we create a few of the function inputs then use <code>builtins.foldl'</code>. Let's look closer at the <code>foldl'</code> call. <code>foldl'</code> takes in 3 arguments: a function to apply to each member of the list, <code>(acc: val: acc // mkReverseProxy val)</code> a starting state of the new value <code>{}</code> and the list itself <code>proxies</code>. The function we apply to the list simply appends the result of running <code>mkReverseProxy</code> on the value from <code>proxies</code> to the end of our accumulator (the attribute set with the starting state <code>{}</code>) using the <code>//</code> syntax for joining attribute sets.</p>
<p>Hey... that syntax at the top that's in every single one of your configuration files for NixOS looks suspiciously like a function definition...</p>
<p>Thank you <a href="https://www.reddit.com/user/ecco256/">u/ecco256</a> and <a href="https://www.reddit.com/user/C0V3RT_KN1GHT/">u/C0V3RT_KN1GHT</a> for helping improve this!</p>
<hr />
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn-currying_wiki">
<p>This is called currying. For more information see the Wikipedia article <a href="https://wikipedia.org/wiki/Currying">wikipedia.org/wiki/Currying</a> <a href="#fr-currying_wiki-1">↩</a></p>
</li>
<li id="fn-anon_functions">
<p>You can write any function in parentheses like this, these are called anonymous functions, just meaning any function with no label. You only need to assign a function a name with the <code>let in</code> syntax if it needs it, otherwise you can just omit the name completely, for example if you were using the function as an input to another function. <a href="#fr-anon_functions-1">↩</a></p>
</li>
</ol>
</section>


    </div>
  </section>
</body>

</html>
